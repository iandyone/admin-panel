generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Credentials {
  id       Int    @id @unique @default(autoincrement())
  userId   Int    @map("user_id")
  email    String @unique
  password String
  role     Role?  @default(DELIVERY)

  user User @relation(fields: [userId], references: [id])

  @@map("credentials")
}

model User {
  id        Int    @id @unique @default(autoincrement())
  firstName String @map("first_name")
  lastName  String @map("last_name")

  phone String @unique

  isActive     Boolean   @default(true) @map("is_active")
  lastActivity DateTime? @map("last_activity")
  updatedAt    DateTime? @updatedAt() @map("updated_at")
  createdAt    DateTime? @default(now()) @map("created_at")
  orders       Int       @default(0)

  managedOrders   Order[]       @relation("ManagerOrders")
  deliveredOrders Order[]       @relation("DeliverymanOrders")
  credentials     Credentials[]

  @@map("users")
}

model Order {
  id            Int         @id @unique @default(autoincrement())
  invoice       Int         @default(0)
  location      String
  customer      String
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt() @map("updated_at")
  managerId     Int         @map("manager_id")
  deliverymanId Int         @map("deliveryman_id")
  status        OrderStatus @default(CREATED)
  products      Product[]

  manager     User @relation("ManagerOrders", fields: [managerId], references: [id])
  deliveryman User @relation("DeliverymanOrders", fields: [deliverymanId], references: [id])

  @@map("orders")
}

model Product {
  id       Int             @id @unique @default(autoincrement())
  name     String          @unique
  price    Int
  category ProductCategory

  orders Order[]

  @@map("products")
}

enum Role {
  ADMIN
  MANAGER
  DELIVERY
}

enum OrderStatus {
  CREATED
  COMPLETED
  PROCESSING
  HOLD
  SHIPPED
  DELIVERED
  RETURNED
  CANCELLED
}

enum ProductCategory {
  APPETIZERS
  SOUPS
  SALADS
  MAINS
  DESSERTS
  DRINKS
  ALCOHOL
}
